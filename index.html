<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>3D Model Viewer</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        background: black;
        font-family: Arial, sans-serif;
      }
      #viewer {
        width: 100%;
        height: 100vh;
        position: relative;
        background: #000;
      }
      #progress-container {
        width: 60%;
        margin: 10px auto;
        background: #444;
        height: 20px;
        border-radius: 10px;
        overflow: hidden;
      }
      #progress-bar {
        height: 100%;
        width: 0%;
        background: #3CB371;
        transition: width 0.1s ease;
      }
      .center {
        text-align: center;
        color: white;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 10;
      }
      #details-panel {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px;
        border-radius: 8px;
        font-size: 14px;
      }
      #rotation-cube {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 100px;
        height: 100px;
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid #3CB371;
        cursor: pointer;
      }
      canvas {
        display: block;
      }
    </style>
  </head>

  <body>
    <!-- Viewer -->
    <div id="viewer">
      <!-- Rotation Cube -->
      <div id="rotation-cube"></div>
      <!-- Details Panel -->
      <div id="details-panel">
        <p><strong>Model Details:</strong></p>
        <p id="model-name">Name: Loading...</p>
        <p id="model-size">Size: Calculating...</p>
        <p id="model-material">Material: Loading...</p>
      </div>
    </div>

    <!-- Loader -->
    <div id="loading-status" class="center">
      <div id="progress-container">
        <div id="progress-bar"></div>
      </div>
      <span id="loading-text">Loading...</span>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r135/three.min.js"></script>
    <script src="./dist/js-3d-model-viewer.js"></script>
    <script>
      const modelPlayer = this.Js3dModelViewer;
      const viewerElement = document.getElementById('viewer');
      const rotationCubeElement = document.getElementById('rotation-cube');
      const detailsPanel = document.getElementById('details-panel');
      const loadingStatus = document.getElementById('loading-status');
      const progressBar = document.getElementById('progress-bar');
      const loadingText = document.getElementById('loading-text');
      const modelNameElement = document.getElementById('model-name');
      const modelSizeElement = document.getElementById('model-size');
      const modelMaterialElement = document.getElementById('model-material');

      // Prepare the scene
      const scene = modelPlayer.prepareScene(viewerElement, {
        grid: true,
        background: 'rgb(80, 80, 80)', // Background color
      });

      // Create rotation cube using THREE.js
      const cubeScene = new THREE.Scene();
      const cubeCamera = new THREE.PerspectiveCamera(50, 1, 0.1, 100);
      cubeCamera.position.z = 2;

      const cubeRenderer = new THREE.WebGLRenderer({ alpha: true });
      cubeRenderer.setSize(100, 100);
      rotationCubeElement.appendChild(cubeRenderer.domElement);

      const cubeGeometry = new THREE.BoxGeometry();
      const cubeMaterial = new THREE.MeshBasicMaterial({
        color: 0x3CB371,
        wireframe: true,
      });
      const rotationCube = new THREE.Mesh(cubeGeometry, cubeMaterial);
      cubeScene.add(rotationCube);

      function animateCube() {
        cubeRenderer.render(cubeScene, cubeCamera);
        requestAnimationFrame(animateCube);
      }
      animateCube();

      // Rotate the main scene based on cube interaction
      rotationCubeElement.addEventListener('mousedown', () => {
        document.addEventListener('mousemove', rotateScene, false);
        document.addEventListener('mouseup', () => {
          document.removeEventListener('mousemove', rotateScene, false);
        });
      });

      function rotateScene(event) {
        const rotationX = event.movementX * 0.005;
        const rotationY = event.movementY * 0.005;
        modelPlayer.rotateScene(scene, { x: rotationX, y: rotationY, z: 0 });
      }

      // Simulate progress tracking for model loading
      function simulateLoading() {
        let loaded = 0;
        const total = 100;

        const interval = setInterval(() => {
          loaded += 10;
          updateProgress(loaded, total);

          if (loaded >= total) {
            clearInterval(interval);
            completeLoading();
          }
        }, 300);
      }

      // Update progress bar and text
      function updateProgress(loaded, total) {
        const progress = Math.min(Math.floor((loaded / total) * 100), 100);
        progressBar.style.width = `${progress}%`;
        loadingText.innerText = `Loading... ${progress}%`;
      }

      // Complete loading and hide loader
      function completeLoading() {
        loadingStatus.style.display = 'none';
        updateModelDetails('Sample 02', '1024 KB', 'Default Material');
      }

      // Update model details panel
      function updateModelDetails(name, size, material) {
        modelNameElement.innerText = `Name: ${name}`;
        modelSizeElement.innerText = `Size: ${size}`;
        modelMaterialElement.innerText = `Material: ${material}`;
      }

      // Load Sample 2 model
      modelPlayer.loadObject(
        scene,
        './assets/sample_02.obj',
        './assets/sample_02.mtl',
        () => {
          simulateLoading();
        }
      );
    </script>
  </body>
</html>
